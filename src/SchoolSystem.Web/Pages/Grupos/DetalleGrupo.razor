@page "/grupos/detalles/{GrupoId:int}"
@using SchoolSystem.Web.Models
@using SchoolSystem.Web.Services
@inject InscripcionService InscripcionService
@inject GrupoService GrupoService
@inject NavigationManager Navigation
@attribute [Authorize]

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3><i class="oi oi-people"></i> Lista de Alumnos</h3>
        <button class="btn btn-secondary" @onclick="Volver">Volver</button>
    </div>

    @if (grupo != null)
    {
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">@grupo.NombreCompleto</h5>
                <p class="card-text text-muted">Ciclo: @grupo.CicloEscolar | Turno: @grupo.Turno | Aula: @grupo.Aula</p>
            </div>
        </div>
    }

    @if (isLoading)
    {
        <div class="text-center"><div class="spinner-border text-primary"></div></div>
    }
    else if (alumnos == null || !alumnos.Any())
    {
        <div class="alert alert-warning">No hay alumnos inscritos en este grupo.</div>
    }
    else
    {
        <div class="table-responsive bg-white shadow-sm rounded">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Matrícula</th>
                        <th>Nombre</th>
                        <th>Estatus</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int i = 1;
                    }
                    @foreach (var item in alumnos)
                    {
                        <tr>
                            <td>@(i++)</td>
                            <td>@item.Matricula</td>
                            <td>@item.NombreCompletoAlumno</td>
                            <td><span class="badge bg-success">@item.Estatus</span></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="mt-3 text-muted text-end">
            Total: @alumnos.Count alumnos
        </div>
    }

@code {
    [Parameter] public int GrupoId { get; set; }
    private List<InscripcionDto> alumnos;
    private GrupoDto grupo;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var t1 = InscripcionService.GetAlumnosPorGrupoAsync(GrupoId);
        var t2 = GrupoService.GetByIdAsync(GrupoId);

        await Task.WhenAll(t1, t2);

        if (t1.Result.Succeeded)
            alumnos = t1.Result.Data;
        if (t2.Result.Succeeded)
            grupo = t2.Result.Data;

        isLoading = false;
    }

    private void Volver()
    {
        Navigation.NavigateTo("mi-clase");
    }
}